<%= editable_tag(:h1, "test-page-header") %>
<%= editable_tag(:div, "test-page-body") %>

<script>
  function saveCallback(editor) {
    editor.setProgressState(true);

    var element = $(editor.getElement())
      , key = element.data('content-key')
      , locale = element.data('locale')
    ;

    $.ajax('/editor_content', {
      method: "POST",
      data: {
        key: key
      , value: editor.getContent()
      , locale: locale
      },
      complete: function () {
        var showFn = function() {
          editor.show(); 
        }

        element.off('click', showFn).on('click', showFn);
        editor.hide();
        editor.setProgressState(false);
      },
      error: function() {
        alert("Oops, something went wrong! Please try again later.");
      }
    });
  }

  tinymce.init({
    selector: 'h1[data-editable="true"]',
    inline: true,
    plugins: 'save paste',
    toolbar: 'undo redo | save',
    save_onsavecallback: saveCallback,
    menubar: false,
    valid_styles: {
      '*': ''
    },
    valid_elements: ''
  });

  tinymce.init({
    selector: 'div[data-editable="true"]',
    inline: true,
    plugins: 'save paste link',
    toolbar: 'undo redo | bold italic | bullist | link | save',
    save_onsavecallback: saveCallback,
    menubar: false,
    valid_styles: {
      '*': ''
    },
    valid_elements: 'a[href],strong/b,p,br,ul,li,em'
  });
</script>

